##### 0607

---

### WHERE 조건

| 종류             | 연산자                     | 설명 및 예시                                                 |
| ---------------- | -------------------------- | ------------------------------------------------------------ |
| 비교             | =,<,>,<=,>=,!=             | 값의 크기를 비교하여 질의 검색<br />price >= 10000           |
| 범위             | BETWEEN                    | 검사 값이 기술된 두 값 사이에 속하는지 검사하여 질의 처리<br />price BETWEEN 10000 AND 20000 |
| 리스트 포함      | IN, NOT IN                 | 검사 값이 주어진 값의 리스트에 속하는지 여부를 검사<br />price IN (10000, 20000, 30000) |
| NULL             | IS NULL, <br />IS NOT NULL | price IS NULL                                                |
| 논리             | AND, OR                    | 단순 탐색 조건을 결합하여 질의 처리<br />(price <= 10000) AND (name LIKE '김%') |
| 문자열 검색/비교 | LIKE                       | 문자열의 일부가 일치하는 데이터 검색<br />prdName LIKE '%프린터%' |



#### 패턴 매칭(문자열 검색) - LIKE

| 와일드카드 문자 | 설명                                 | 예         |
| --------------- | ------------------------------------ | ---------- |
| **%**           | **0개 이상의 문자**를 가진 문자열    | LIKE '홍%' |
| _               | **단일 문자**(수 만큼의 문자로 구성) | LIKE '__'  |

| 문자열 연산 예      | 설명                                                         |
| ------------------- | ------------------------------------------------------------ |
| **'홍%'**           | **'홍'으로 시작**하는 문자열 검색                            |
| **'%길%'**          | **'길'을 포함**하는 문자열('길' 앞, 뒤에 아무 문자나 와도 됨) |
| **'%동'**           | **'동'으로 끝**나는 문자열                                   |
| **'____' ( _ 4개)** | **4개의 문자로 구성**된 문자열(밑줄 문자 1개가 1문자)        |



#### ORDER BY

- 특정 열의 값을 기준으로 질의 결과 정렬
- ASC : 오름차순 (생략 가능)
- DESC : 내림차순



#### 집계 함수

- SUM() : 합계
- AVG() : 평균
- COUNT() : 선택된 열의 행 수 (NULL 값은 제외)
- COUNT(*) : 전체 행의 수
- MAX() : 최대값
- MIN() : 최소값

---



### GROUP BY 절



#### GROUP BY <속성>

- 그룹 질의를 기술할 때 사용

- 특정 열로 그룹화한 후 각 그룹에 대해 한 행씩 질의 결과 생성

  - 주의!

    SELECT 절에는 GROUP BY에서 사용한 열과 집계 함수한 나올 수 있음

    ```sql
    SELECT bookNo, SUM(bsQty) AS "주문량 합계" FROM bookSale GROUP BY bookNo;
    ```

---

### HAVING 절



#### HAVING <검색 조건>

- GROUP BY 절에 의해 구성된 그룹들에 대해 적용할 조건 기술

- SUM, AVG, MAX, MIN, COUNT 등의 집계 함수와 함께 사용

  - 주의!

    - 반드시 GROUP BY 절과 같이 사용

    - WHERE 절보다 뒤에 

    - <검색 조건>에는 SUM, AVG, MAX, MIN, COUNT 등의 집계 함수만 와야 함

---

### DDL / DML 정리



#### DDL (Data Definition Language, 데이터 정의어)

- CREATE / ALTER / DROP
- 데이터베이스, 테이블, 뷰, 인덱스 등의 데이터베이스 개체를 생성 / 삭제 / 변경하는 역할
- 직접 데이터베이스의 테이블에 영향을 미치기 때문에
- DDL 명령어 를 입력하는 순간 처리 작업이 즉시 완료
- AUTO COMMIT
- 따라서 작업 취소(ROLLBACK)이나 완료(COMMIT)을 수행할 필요 없음



#### DML (Date Manipulation Language, 데이터 조작어)

- INSERT / UPDATE / DELETE / SELECT
- 데이터를 삽입 / 수정 / 삭제 / 조회 하는데에 사용
- 대상은 테이블의 행
- 조작 작업이 메모리 버퍼에서 수행되어 실시간으로 테이블에 영향을 미치지 않음(실수가 있었을 경우 작업 취소 가능) - 트랜잭션 발행
- DML 명령어가 실제 테이블에 반영되게 하기 위해서는 COMMIT 명령어를 입력하여 작업을 종료해야 함



#### 트랜잭션 (Transaction)

- DBMS에서 데이터를 다루는 논리적인 작업의 단위
- 데이터베이스 관리 시스템에서 회복 및 병행 수행 시 처리되는 작업의 논리적 단위로 사용
- 하나의 트랜잭션은 정상적으로 종료될 경우 COMMIT 연산이 수행되고
- 비정상적으로 종료돌 경우 ROLLBACK 연산 수행해서 작업을 취소



#### COMMIT 연산

- 트랜잭션 처리가 정상적으로 종료되어
- 트랜잭션이 수행한 변경 내용을 데이터베이스에 반영하는 연산
- 내용을 변경한 트랜잭션이 완료되면 그 트랜잭션에 의해 데이터베이스는 새롭게 일관된 상태로 변경되고
- 이 상태는 시스템에 오류가 발생되더라도 취소되지 않음



#### ROLLBACK 연산

- 하나의 트랜잭션 처리가 비정상적으로 종료되어
- 데이터베이스의 일관성이 깨졌을 때 트랜잭션이 행한 모든 변경 작업을 취소하고 이전 상태로 되돌리는 연산



----

### JOIN



#### JOIN(조인)

- 여러 개의 테이블을 결합하여 조건에 맞는 행 검색



#### JOIN의 종류

- **INNER JOIN(내부 조인)** - 가장 많이 사용
  - **공통되는 열**이 있을 때
  - 공통 속성의 속성값이 동일한 튜플만 반환
- **OUTER JOIN(외부 조인)** 
  - 공통되는 열이 없을 때
  - 공통된 속성을 매개로 하는 정보가 없더라도 버리지 않고 연산의 결과를 릴레이션에 표시
  - 값이 없는 대응 속성에는 NULL 값을 채워서 반환
  - 좌측 외부 조인(Left Outer JOIN)
    - 좌측 릴레이션의 정보 유지
  - 우측 외부 조인(Right Outer JOIN)
    - 우츨 릴레이션의 정보 유지
  - 완전 외부 조인(Full Outer JOIN)
    - 두 릴레이션의 모든 정보 유지





#### JOIN 기본 형식

- **SELECT** 열리스트 **FROM** 테이블명1 **INNER JOIN** 테이블명2 **ON** 조인조건(기본키=외래키);



#### 3개 테이블 JOIN

- JOIN 조건 2개 필요





#### SubQuery

- 하위 질의 또는 부속질의 라고도 함
- 하나의 SQL 문 안에 다른 SQL 문이 중첩(nested)
- 쿼리를 1차 수행한 다음, 반환값(결과)을 다음 쿼리에 포함시켜 사용
- 다른 테이블에서 가져온 데이터로 현재 테이블에 있는 정보를 찾거나 가공할 때 사용



#### 조인 VS 서브쿼리

- JOIN
  - 여러 테이블의 데이터를 모두 합쳐서 연산
  - 카티전곱 (15 x 3 = 45 행 반환) 후 조건에 맞는 행 검색 - 15행 테이블 X 3행 테이블
  - 카티전곱 연산 + SELECT 연산
- Subquery
  - 필요한 데이터만 찾아서 제공
  - 15행을 검색한 결과를 가지고 3행에서 검색
    - 총 18행 검색
  - 경우에 따라 조인보다 성능이 더 좋을 수 도 있지만 
  - 대량의 데이터에서 서브쿼리를 수행할 때 성능이 더 나쁠 수 있음



#### 단일 행 서브 쿼리

- 서브 쿼리 결과 같이 단일 행
- ' = ' 연산자 사용



#### 다중 행 서브 쿼리

- 서브 쿼리 결과 값이 여러 행
- IN, ANY, ALL, EXISTS 연산자 사용



#### 서브 쿼리 연산자

- WHERE 절에서 사용
- 데이터를 선택하는 조건 또는 술어와 같이 사용

| 연산 | 연산자                    | 반환 행 |
| ---- | ------------------------- | ------- |
| 비교 | =,<,>,<=,>=,!=            | 단일    |
| 집합 | IN, NOT IN                | 다중    |
| 존재 | EXISTS, NOT EXISTS        | 다중    |
| 한전 | ALL(모두), ANY(최소 하나) | 다중    |

